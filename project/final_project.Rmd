---
title: "STAT 512 Final Project"
subtitle: "Effects of Brief Meditation on Mother Respiratory Sinus Arrhythmia"
author: "Kathleen E. Wendt"
date: "May 10, 2020"
output: pdf_document
---

```{r global_options, include = FALSE}
# set global options for figures, code, warnings, and messages
knitr::opts_chunk$set(fig.width = 6, 
                      fig.height = 4, 
                      fig.path = "figs/",
                      echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE)
```

```{r load_packages, include = FALSE}
# load packages
library(tidyverse) # for reading and manipulating data
library(kableExtra) # for tables
library(nlme) # for repeated measures modeling
library(emmeans) # for comparing estimated marginal means
```

```{r prepare_data, include = FALSE}
# read in treatment assignment data and filter to mothers only
trt_audio <- readr::read_csv("data/audio_parent.csv") %>%
  dplyr::filter(individual == 1) # filter to only mothers
# prepare all data for summaries and models
rsa_trt_data <- readr::read_csv("data/hrv_parent_valid.csv") %>%
  dplyr::select(family, individual, task, rsa_mean_task) %>% 
  dplyr::filter(individual == 1) %>% # filter to only mothers
  dplyr::distinct() %>% # collapse to distinct observations
  dplyr::group_by(family) %>% # group by mother id
  dplyr::mutate(rsa_diff = rsa_mean_task - lag(rsa_mean_task)) %>% # calc diff
  dplyr::ungroup() %>% # ungroup by mother id
  dplyr::full_join(trt_audio, by = c("family", "individual")) %>% # trt var
  dplyr::mutate(task = as.factor(task), # convert time and trt to fct
                condition = as.factor(condition)) %>% 
  dplyr::select(-individual) %>% # drop individual label (all mothers)
  dplyr::rename(mother_id = family) ## rename family id as mother id
```

# Introduction

## Background

This project is a sliver of my master's thesis, which I will defend in June 2020. We conducted a pilot study of a brief mindfulness induction (focused-attention meditation) on self- and co-regulation between parents and young children (ages 4.5 - 6.5) during a challenging dyadic task. My master's thesis investigates the effects of a meditation on parent autonomic nervous system activity during a challenging parenting moment and individual differences in such by prior contemplative experience and dispositional mindfulness. 

## Research Question

General: How does a mindfulness meditation affect parasympathetic nervous system activity in mothers during a subsequent challenging parent-child interaction? 

Specific: How does the average change in respiratory sinus arrhythmia (response) in mothers (subject/block) differ by treatment group (meditation vs. podcast) across phases of a challenging parenting task (time period)?

# Description

The observational/experimental unit is an individual parent. 

For the purposes of this assignment, I will only consider the subset of mothers (N = 40), but 27 fathers also participated in this study. The blocking variable is subject (mother).

The response variable is the average change in respiratory sinus arrhythmia (RSA), which is a noninvasive indicator of parasympathetic nervous system activity. RSA is a continuous variable but will be calculated as a difference score from baseline. 

The predictor variables are audio recording as treatment (between-subjects factor) and protocol task as time period (within-subjects factor). Treatment is a categorical variable with two levels: control (0) and experimental (1). Mothers were randomly assigned to a group, balancing for child gender, child age, parent gender, parent mental health, and family strengthening activities. The experimental group listened a focused-attention meditation, whereas the control group listened to an educational podcast about the benefits of sleep for the same duration. Time period is a categorical variable with 5 levels: 3-minute resting period; 5.5-minute audio treatment; 4-minute dyadic challenge (part 1); 3-minute dyadic stressor (part 2); 3-minute dyadic recovery (part 3). When the response is calculated as a difference score from baseline/resting period, only the latter 4 levels will remain.

# Summary

```{r mean_rsa_diff_plot}
# plot mean rsa diff score by time and trt
rsa_trt_data %>% 
  dplyr::filter(task != 1) %>% # drop task 1 (empty vector)
  ggplot(aes(x = task, y = rsa_diff)) + # plot response over time
  stat_summary(aes(group = condition, color = condition), # mean rsa diff
               geom = "line", fun = mean) + 
  theme_bw() + 
  ggtitle("Mean RSA difference across time and by treatment") 
```

```{r rsa_sum_stats}
# calculate mean rsa difference by task/time period and treatment condition
rsa_sum_stats <- rsa_trt_data %>%
  dplyr::filter(task != 1) %>% # drop task 1
  dplyr::group_by(task, condition) %>% 
  dplyr::summarize(n = n(), # count obs
                   mean_rsa_diff = mean(rsa_diff), # mean rsa diff 
                   sd_rsa_diff = sd(rsa_diff), # sd mean rsa diff
                   se_rsa_diff = sd_rsa_diff/sqrt(n)) # se mean rsa diff
# kable table for rsa summary statistics
kableExtra::kable(rsa_sum_stats) %>% 
  kable_styling(position = "center")
```

# Analysis

## Description

two-factor repeated measures analysis of variance with difference scores as response

y = rsa difference score
block = subject (random)
treatment = audio (fixed)
time period = task (fixed)
time*trt interaction

- description/discussion of analysis - reproducible

## Justification

- justify any decisions (model selection)

## Assumptions

- discuss model assumptions (consider including diagnostic plots)

## Results

- Type 3 ANOVA table and/or table of estimated coefficients or other tables

# Conclusions 

- interpretation and discussion (even if nothing is significant!)
- address research questions 

# Acknowledgements

Data collection was funded by the Colorado State University Prevention Research Center. This material is based upon work supported by the National Science Foundation Graduate Research Fellowship under Grant No. 006784-00002, awarded to KEW.

\newpage

# Appendix

```{r show_code, ref.label = knitr::all_labels(), echo = TRUE, eval = FALSE}
```
